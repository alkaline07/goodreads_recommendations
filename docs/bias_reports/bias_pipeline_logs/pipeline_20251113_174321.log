
================================================================================
BIAS DETECTION AND MITIGATION PIPELINE
================================================================================

Configuration:
  Model Selection: ENABLED
  Visualizations: ENABLED
  Performance Weight: 0.6
  Fairness Weight: 0.4
  Min Fairness Threshold: 60.0

BiasDetector initialized for project: recommendation-system-475301
BiasMitigator initialized for project: recommendation-system-475301
BiasVisualizer initialized
Output directory: ../docs/bias_reports/visualizations

BiasDetector initialized for project: recommendation-system-475301
BiasVisualizer initialized
Output directory: ../docs/bias_reports/model_selection

ModelSelector initialized
  Performance weight: 0.6
  Fairness weight: 0.4
  Min fairness threshold: 50.0

BiasAuditPipeline initialized for project: recommendation-system-475301

================================================================================
MODEL SELECTION PIPELINE (PERFORMANCE + FAIRNESS)
================================================================================

Comparing 2 models...
Weights: 60% Performance + 40% Fairness
Minimum Fairness Threshold: 60.0


################################################################################
# AUDITING MODEL 1/2: boosted_tree_regressor
################################################################################


================================================================================
BIAS AUDIT PIPELINE: boosted_tree_regressor
================================================================================


[STEP 1/4] Running Bias Detection...
================================================================================
BIAS DETECTION: boosted_tree_regressor on test dataset
================================================================================

Analyzing 8 dimensions...
  Processing: Popularity... (3 slices)
  Processing: Book Length... (4 slices)
  Processing: Book Era... (4 slices)
  Processing: Genre Diversity... (2 slices)
  Processing: User Activity... (1 slices)
  Processing: Reading Pace... (4 slices)
  Processing: Author Gender... (3 slices)
  Processing: Rating Range... (2 slices)

Computed metrics for 23 total slices

Analyzing disparities...

Generating recommendations...

================================================================================
BIAS DETECTION SUMMARY
================================================================================

Model: boosted_tree_regressor
Dataset: test
Timestamp: 2025-11-13T17:43:30.224384
Total Slices Analyzed: 23

--- Performance Disparities ---
  • Book Era [HIGH]:
    MAE Range: 0.8249, CV: 0.2655
  • Rating Range [HIGH]:
    MAE Range: 2.2954, CV: 0.4494

--- High-Risk Slices ---
  • Book Era=classic: MAE=1.5343 (+26.9% above average)
  • Rating Range=Medium (3-4): MAE=3.7016 (+44.9% above average)

--- Recommendations ---
  1. HIGH PRIORITY: 2 dimensions show severe performance disparities. Dimensions: Book Era, Rating Range
  2. Target these high-error slices for mitigation: Rating Range=Medium (3-4) (MAE: 3.702), Book Era=classic (MAE: 1.534)
  3. Book Era: Consider re-weighting training data or adjusting decision thresholds to balance performance across 4 groups
  4. Rating Range: Consider re-weighting training data or adjusting decision thresholds to balance performance across 2 groups

================================================================================

Bias report saved to: ../docs/bias_reports/boosted_tree_regressor_detection_report.json
Error converting Pandas column with name: "analysis_timestamp" and datatype: "object" to an appropriate pyarrow datatype: Array, ListArray, or StructArray
Error creating bias metrics table: Error converting Pandas column with name: "analysis_timestamp" and datatype: "object" to an appropriate pyarrow datatype: Array, ListArray, or StructArray

[STEP 1.5/5] Generating Visualizations...

================================================================================
GENERATING VISUALIZATIONS: boosted_tree_regressor
================================================================================

1. Creating fairness scorecard...
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_fairness_scorecard.png
2. Creating disparity heatmap...
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_disparity_heatmap.png
3. Creating slice comparison charts...
   1/8: Popularity
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_Popularity_mae_comparison.png
   2/8: User Activity
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_User_Activity_mae_comparison.png
   3/8: Genre Diversity
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_Genre_Diversity_mae_comparison.png
   4/8: Book Length
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_Book_Length_mae_comparison.png
   5/8: Book Era
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_Book_Era_mae_comparison.png
   6/8: Author Gender
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_Author_Gender_mae_comparison.png
   7/8: Reading Pace
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_Reading_Pace_mae_comparison.png
   8/8: Rating Range
Saved: ../docs/bias_reports/visualizations/boosted_tree_regressor_Rating_Range_mae_comparison.png

All visualizations saved to: ../docs/bias_reports/visualizations

================================================================================


[STEP 2/5] Skipping mitigation (no significant bias detected or not requested)

[STEP 3/5] Skipping validation (no mitigation applied)

[STEP 4/5] Generating Comprehensive Audit Report...

Comprehensive audit report saved to: ../docs/bias_reports/boosted_tree_regressor_comprehensive_audit.json

[STEP 5/5] Skipping model selection (disabled or handled separately)

================================================================================
BIAS AUDIT COMPLETE
================================================================================

Full audit report: ../docs/bias_reports/boosted_tree_regressor_comprehensive_audit.json
Visualizations: ../docs/bias_reports/visualizations/


################################################################################
# AUDITING MODEL 2/2: matrix_factorization
################################################################################


================================================================================
BIAS AUDIT PIPELINE: matrix_factorization
================================================================================


[STEP 1/4] Running Bias Detection...
================================================================================
BIAS DETECTION: matrix_factorization on test dataset
================================================================================

Analyzing 8 dimensions...
  Processing: Popularity... (3 slices)
  Processing: Book Length... (4 slices)
  Processing: Book Era... (4 slices)
  Processing: Genre Diversity... (2 slices)
  Processing: User Activity... (1 slices)
  Processing: Reading Pace... (4 slices)
  Processing: Author Gender... (3 slices)
  Processing: Rating Range... (2 slices)

Computed metrics for 23 total slices

Analyzing disparities...

Generating recommendations...

================================================================================
BIAS DETECTION SUMMARY
================================================================================

Model: matrix_factorization
Dataset: test
Timestamp: 2025-11-13T17:43:58.099552
Total Slices Analyzed: 23

--- Performance Disparities ---
  • Popularity [MEDIUM]:
    MAE Range: 0.3305, CV: 0.0872
  • Book Era [MEDIUM]:
    MAE Range: 0.6680, CV: 0.1636
  • Rating Range [HIGH]:
    MAE Range: 2.8929, CV: 0.4519

--- High-Risk Slices ---
  • Rating Range=Medium (3-4): MAE=4.6470 (+45.2% above average)

--- Recommendations ---
  1. HIGH PRIORITY: 1 dimensions show severe performance disparities. Dimensions: Rating Range
  2. MEDIUM PRIORITY: 2 dimensions show moderate disparities. Dimensions: Popularity, Book Era
  3. Target these high-error slices for mitigation: Rating Range=Medium (3-4) (MAE: 4.647)
  4. Rating Range: Consider re-weighting training data or adjusting decision thresholds to balance performance across 2 groups

================================================================================

Bias report saved to: ../docs/bias_reports/matrix_factorization_detection_report.json
Error converting Pandas column with name: "analysis_timestamp" and datatype: "object" to an appropriate pyarrow datatype: Array, ListArray, or StructArray
Error creating bias metrics table: Error converting Pandas column with name: "analysis_timestamp" and datatype: "object" to an appropriate pyarrow datatype: Array, ListArray, or StructArray

[STEP 1.5/5] Generating Visualizations...

================================================================================
GENERATING VISUALIZATIONS: matrix_factorization
================================================================================

1. Creating fairness scorecard...
Saved: ../docs/bias_reports/visualizations/matrix_factorization_fairness_scorecard.png
2. Creating disparity heatmap...
Saved: ../docs/bias_reports/visualizations/matrix_factorization_disparity_heatmap.png
3. Creating slice comparison charts...
   1/8: Popularity
Saved: ../docs/bias_reports/visualizations/matrix_factorization_Popularity_mae_comparison.png
   2/8: User Activity
Saved: ../docs/bias_reports/visualizations/matrix_factorization_User_Activity_mae_comparison.png
   3/8: Genre Diversity
Saved: ../docs/bias_reports/visualizations/matrix_factorization_Genre_Diversity_mae_comparison.png
   4/8: Book Length
Saved: ../docs/bias_reports/visualizations/matrix_factorization_Book_Length_mae_comparison.png
   5/8: Book Era
Saved: ../docs/bias_reports/visualizations/matrix_factorization_Book_Era_mae_comparison.png
   6/8: Author Gender
Saved: ../docs/bias_reports/visualizations/matrix_factorization_Author_Gender_mae_comparison.png
   7/8: Reading Pace
Saved: ../docs/bias_reports/visualizations/matrix_factorization_Reading_Pace_mae_comparison.png
   8/8: Rating Range
Saved: ../docs/bias_reports/visualizations/matrix_factorization_Rating_Range_mae_comparison.png

All visualizations saved to: ../docs/bias_reports/visualizations

================================================================================


[STEP 2/5] Skipping mitigation (no significant bias detected or not requested)

[STEP 3/5] Skipping validation (no mitigation applied)

[STEP 4/5] Generating Comprehensive Audit Report...

Comprehensive audit report saved to: ../docs/bias_reports/matrix_factorization_comprehensive_audit.json

[STEP 5/5] Skipping model selection (disabled or handled separately)

================================================================================
BIAS AUDIT COMPLETE
================================================================================

Full audit report: ../docs/bias_reports/matrix_factorization_comprehensive_audit.json
Visualizations: ../docs/bias_reports/visualizations/


================================================================================
RUNNING MODEL SELECTION
================================================================================

BiasDetector initialized for project: recommendation-system-475301
BiasVisualizer initialized
Output directory: ../docs/bias_reports/model_selection

ModelSelector initialized
  Performance weight: 0.6
  Fairness weight: 0.4
  Min fairness threshold: 60.0


================================================================================
MODEL SELECTION BASED ON PERFORMANCE + FAIRNESS
================================================================================

Evaluating 2 models...
Criteria: 60% Performance + 40% Fairness

Note: With 2 models, performance scores use percentage-based comparison
   This shows actual performance gaps rather than artificial extremes


Evaluating model: boosted_tree_regressor
  Predictions table: recommendation-system-475301.books.boosted_tree_rating_predictions
================================================================================
BIAS DETECTION: boosted_tree_regressor on test dataset
================================================================================

Analyzing 8 dimensions...
  Processing: Popularity... (3 slices)
  Processing: Book Length... (4 slices)
  Processing: Book Era... (4 slices)
  Processing: Genre Diversity... (2 slices)
  Processing: User Activity... (1 slices)
  Processing: Reading Pace... (4 slices)
  Processing: Author Gender... (3 slices)
  Processing: Rating Range... (2 slices)

Computed metrics for 23 total slices

Analyzing disparities...

Generating recommendations...

================================================================================
BIAS DETECTION SUMMARY
================================================================================

Model: boosted_tree_regressor
Dataset: test
Timestamp: 2025-11-13T17:44:20.953136
Total Slices Analyzed: 23

--- Performance Disparities ---
  • Book Era [HIGH]:
    MAE Range: 0.8249, CV: 0.2655
  • Rating Range [HIGH]:
    MAE Range: 2.2954, CV: 0.4494

--- High-Risk Slices ---
  • Book Era=classic: MAE=1.5343 (+26.9% above average)
  • Rating Range=Medium (3-4): MAE=3.7016 (+44.9% above average)

--- Recommendations ---
  1. HIGH PRIORITY: 2 dimensions show severe performance disparities. Dimensions: Book Era, Rating Range
  2. Target these high-error slices for mitigation: Rating Range=Medium (3-4) (MAE: 3.702), Book Era=classic (MAE: 1.534)
  3. Book Era: Consider re-weighting training data or adjusting decision thresholds to balance performance across 4 groups
  4. Rating Range: Consider re-weighting training data or adjusting decision thresholds to balance performance across 2 groups

================================================================================
MAE: 1.4063, RMSE: 1.6450

Evaluating model: matrix_factorization
  Predictions table: recommendation-system-475301.books.matrix_factorization_rating_predictions
================================================================================
BIAS DETECTION: matrix_factorization on test dataset
================================================================================

Analyzing 8 dimensions...
  Processing: Popularity... (3 slices)
  Processing: Book Length... (4 slices)
  Processing: Book Era... (4 slices)
  Processing: Genre Diversity... (2 slices)
  Processing: User Activity... (1 slices)
  Processing: Reading Pace... (4 slices)
  Processing: Author Gender... (3 slices)
  Processing: Rating Range... (2 slices)

Computed metrics for 23 total slices

Analyzing disparities...

Generating recommendations...

================================================================================
BIAS DETECTION SUMMARY
================================================================================

Model: matrix_factorization
Dataset: test
Timestamp: 2025-11-13T17:44:27.568497
Total Slices Analyzed: 23

--- Performance Disparities ---
  • Popularity [MEDIUM]:
    MAE Range: 0.3305, CV: 0.0872
  • Book Era [MEDIUM]:
    MAE Range: 0.6680, CV: 0.1636
  • Rating Range [HIGH]:
    MAE Range: 2.8929, CV: 0.4519

--- High-Risk Slices ---
  • Rating Range=Medium (3-4): MAE=4.6470 (+45.2% above average)

--- Recommendations ---
  1. HIGH PRIORITY: 1 dimensions show severe performance disparities. Dimensions: Rating Range
  2. MEDIUM PRIORITY: 2 dimensions show moderate disparities. Dimensions: Popularity, Book Era
  3. Target these high-error slices for mitigation: Rating Range=Medium (3-4) (MAE: 4.647)
  4. Rating Range: Consider re-weighting training data or adjusting decision thresholds to balance performance across 2 groups

================================================================================
MAE: 1.7542, RMSE: 1.9778

  boosted_tree_regressor:
    MAE: 1.4063 | RMSE: 1.6450
    Performance Score: 100.0/100
    Fairness Score: 60/100
    Combined Score: 84.0/100

  matrix_factorization:
    MAE: 1.7542 | RMSE: 1.9778
    Performance Score: 77.5/100
    Fairness Score: 60/100
    Combined Score: 70.5/100

================================================================================
MODEL SELECTION SUMMARY
================================================================================

SELECTED MODEL: boosted_tree_regressor
   Combined Score: 84.0/100
   Performance Score: 100.0/100
   Fairness Score: 60.0/100
   Validation MAE: 1.4063
   Validation RMSE: 1.6450

ALL CANDIDATES:
Model                          MAE        Perf     Fair     Combined   Status
-------------------------------------------------------------------------------------
boosted_tree_regressor         1.4063     100.0    60.0     84.0       SELECTED
matrix_factorization           1.7542     77.5     60.0     70.5         

RATIONALE:
   Selected 'boosted_tree_regressor' with combined score of 84.0/100. This model outperforms alternatives in both accuracy and fairness, though fairness could be improved. CAUTION: Model has 2 high-severity bias disparities and low fairness (60/100). Mitigation strongly recommended before deployment.

TRADE-OFFS:
   No trade-off: Selected model is also the best performer

================================================================================

Selection report saved: ../docs/bias_reports/model_selection_report.json

Generating comparison visualizations...
Saved: ../docs/bias_reports/model_selection/model_comparison.png


================================================================================
APPLYING MITIGATION TO SELECTED MODEL
================================================================================

Model: boosted_tree_regressor
Bias disparities detected: 2

Applying prediction shrinkage to reduce bias...

================================================================================
BIAS AUDIT PIPELINE: boosted_tree_regressor_final
================================================================================


[STEP 1/4] Running Bias Detection...
================================================================================
BIAS DETECTION: boosted_tree_regressor_final on test dataset
================================================================================

Analyzing 8 dimensions...
  Processing: Popularity... (3 slices)
  Processing: Book Length... (4 slices)
  Processing: Book Era... (4 slices)
  Processing: Genre Diversity... (2 slices)
  Processing: User Activity... (1 slices)
  Processing: Reading Pace... (4 slices)
  Processing: Author Gender... (3 slices)
  Processing: Rating Range... (2 slices)

Computed metrics for 23 total slices

Analyzing disparities...

Generating recommendations...

================================================================================
BIAS DETECTION SUMMARY
================================================================================

Model: boosted_tree_regressor_final
Dataset: test
Timestamp: 2025-11-13T17:44:35.977137
Total Slices Analyzed: 23

--- Performance Disparities ---
  • Book Era [HIGH]:
    MAE Range: 0.8249, CV: 0.2655
  • Rating Range [HIGH]:
    MAE Range: 2.2954, CV: 0.4494

--- High-Risk Slices ---
  • Book Era=classic: MAE=1.5343 (+26.9% above average)
  • Rating Range=Medium (3-4): MAE=3.7016 (+44.9% above average)

--- Recommendations ---
  1. HIGH PRIORITY: 2 dimensions show severe performance disparities. Dimensions: Book Era, Rating Range
  2. Target these high-error slices for mitigation: Rating Range=Medium (3-4) (MAE: 3.702), Book Era=classic (MAE: 1.534)
  3. Book Era: Consider re-weighting training data or adjusting decision thresholds to balance performance across 4 groups
  4. Rating Range: Consider re-weighting training data or adjusting decision thresholds to balance performance across 2 groups

================================================================================

Bias report saved to: ../docs/bias_reports/boosted_tree_regressor_final_detection_report.json
Error converting Pandas column with name: "analysis_timestamp" and datatype: "object" to an appropriate pyarrow datatype: Array, ListArray, or StructArray
Error creating bias metrics table: Error converting Pandas column with name: "analysis_timestamp" and datatype: "object" to an appropriate pyarrow datatype: Array, ListArray, or StructArray

[STEP 2/5] Applying Bias Mitigation...

  Applying prediction shrinkage mitigation...
  Lambda: 0.3
  Target dimension: Book Era
  Original MAE CV: 0.2655
  Debiased predictions saved to: recommendation-system-475301.books.boosted_tree_regressor_final_rating_predictions_debiased
  MAE change: +1.32%

[STEP 3/5] Validating Mitigation Effectiveness...

  Re-running bias detection on mitigated predictions...
================================================================================
BIAS DETECTION: boosted_tree_regressor_final_mitigated on test dataset
================================================================================

Analyzing 8 dimensions...
  Processing: Popularity... (3 slices)
  Processing: Book Length... (4 slices)
  Processing: Book Era... (4 slices)
  Processing: Genre Diversity... (2 slices)
  Processing: User Activity... (1 slices)
  Processing: Reading Pace... (4 slices)
  Processing: Author Gender... (3 slices)
  Processing: Rating Range... (2 slices)

Computed metrics for 23 total slices

Analyzing disparities...

Generating recommendations...

================================================================================
BIAS DETECTION SUMMARY
================================================================================

Model: boosted_tree_regressor_final_mitigated
Dataset: test
Timestamp: 2025-11-13T17:44:50.039837
Total Slices Analyzed: 23

--- Performance Disparities ---
  • Book Era [MEDIUM]:
    MAE Range: 0.4542, CV: 0.1333
  • Rating Range [HIGH]:
    MAE Range: 2.3513, CV: 0.4521

--- High-Risk Slices ---
  • Rating Range=Medium (3-4): MAE=3.7761 (+45.2% above average)

--- Recommendations ---
  1. HIGH PRIORITY: 1 dimensions show severe performance disparities. Dimensions: Rating Range
  2. MEDIUM PRIORITY: 1 dimensions show moderate disparities. Dimensions: Book Era
  3. Target these high-error slices for mitigation: Rating Range=Medium (3-4) (MAE: 3.776)
  4. Rating Range: Consider re-weighting training data or adjusting decision thresholds to balance performance across 2 groups

================================================================================

[STEP 4/5] Generating Comprehensive Audit Report...

Comprehensive audit report saved to: ../docs/bias_reports/boosted_tree_regressor_final_comprehensive_audit.json

[STEP 5/5] Skipping model selection (disabled or handled separately)

================================================================================
BIAS AUDIT COMPLETE
================================================================================

Full audit report: ../docs/bias_reports/boosted_tree_regressor_final_comprehensive_audit.json

PRODUCTION-READY TABLE (Debiased):
  recommendation-system-475301.books.boosted_tree_regressor_final_rating_predictions_debiased
  Use this table for production deployment

Mitigation complete!
  Debiased table: recommendation-system-475301.books.boosted_tree_regressor_final_rating_predictions_debiased


================================================================================
MODEL SELECTION COMPLETE
================================================================================

   SELECTED MODEL: boosted_tree_regressor
   Validation MAE: 1.4063
   Fairness Score: 60.0/100
   Combined Score: 84.0/100

RATIONALE:
   Selected 'boosted_tree_regressor' with combined score of 84.0/100. This model outperforms alternatives in both accuracy and fairness, though fairness could be improved. CAUTION: Model has 2 high-severity bias disparities and low fairness (60/100). Mitigation strongly recommended before deployment.

PRODUCTION-READY TABLE (Debiased):
   recommendation-system-475301.books.boosted_tree_regressor_final_rating_predictions_debiased
   Use this table for production deployment

Reports:
   Model Selection: ../docs/bias_reports/model_selection_report.json
   Visualizations: ../docs/bias_reports/model_selection/


================================================================================
PIPELINE COMPLETE
================================================================================

SELECTED MODEL: boosted_tree_regressor
   Production Table: recommendation-system-475301.books.boosted_tree_regressor_final_rating_predictions_debiased

Generated Files:
   - Model Selection Report: ../docs/bias_reports/model_selection_report.json
   - Model Comparison Chart: ../docs/bias_reports/model_selection/model_comparison.png
   - Fairness Visualizations: ../docs/bias_reports/visualizations/

