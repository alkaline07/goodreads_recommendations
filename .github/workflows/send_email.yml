name: Send Email Notification

on:
  workflow_call:
    inputs:
      status:
        required: true
        type: string
      workflow_name:
        required: true
        type: string

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
    - name: Send email via Gmail SMTP
      run: |
        python - << EOF
        import smtplib
        from email.mime.text import MIMEText
        
        sender = "${{ secrets.SMTP_EMAIL }}"
        password = "${{ secrets.SMTP_PASSWORD }}"
        receiver = "${{ secrets.SMTP_EMAIL }}"

        subject = f"GitHub Workflow: ${{ inputs.workflow_name }} - ${{ inputs.status }}"
        body = f"""
        Workflow Name: ${ inputs.workflow_name }
        Status: ${ inputs.status }
        Repository: ${{ github.repository }}
        Commit: ${{ github.sha }}
        Branch: ${{ github.ref_name }}
        """

        msg = MIMEText(body)
        msg["Subject"] = subject
        msg["From"] = sender
        msg["To"] = receiver

        SMTP_SERVER = "smtp.gmail.com"
        SMTP_PORT = 587

        print("Connecting to SMTP...")
        with smtplib.SMTP(SMTP_SERVER, SMTP_PORT) as server:
            server.starttls()
            print("Logging in...")
            server.login(sender, password)
            print("Sending email...")
            server.sendmail(sender, receiver.split(","), msg.as_string())

        print("Email sent!")
        EOF
